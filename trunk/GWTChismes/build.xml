<project name="GWT Project" default="jar">
	<property name="project" value="gwtchismes" />
	<property name="version" value="0.1" />

	<property environment="env" />
	<property name="gwt.dir" value="${env.GWT_HOME}" />
	<property name="gwt.user.jar" value="${gwt.dir}/gwt-user.jar" />
	<property name="gwt.dev.jar" value="${gwt.dir}/gwt-dev-linux.jar" />
	<property name="gwt.servlet.jar" value="${gwt.dir}/gwt-servlet.jar" />

	<property name="src.dir" value="src" />
	<property name="tmp.dir" value="tmp" />
	<property name="doc.dir" value="doc" />
	<property name="package.dir" value="com/google/code/p/gwtchismes" />
	<property name="sample.dir" value="com/google/code/p/gwtcsample" />
	<property name="sample.module" value="com.google.code.p.gwtcsample.GWTCSample" />

	<path id="gwt.classpath">
		<pathelement location="${gwt.user.jar}" />
	</path>

	<target name="jar">
		<delete file="${project}-${version}.zip" />
		<mkdir dir="${tmp.dir}" />
		<javac srcdir="${src.dir}" excludes="${sample.dir}/**" destdir="${tmp.dir}" deprecation="off" debug="on" fork="true">
			<classpath refid="gwt.classpath" />
		</javac>
		<copy todir="${tmp.dir}">
			<fileset dir="${src.dir}" excludes="${sample.dir}/**" />
		</copy>
		<copy todir="${tmp.dir}" file="LICENSE" />
		<jar jarfile="${project}-${version}.jar" basedir="${tmp.dir}" />
		<delete dir="${tmp.dir}" />
	</target>

	<target name="javadoc">
		<delete dir="${doc.dir}"/>
		<javadoc packagenames="${package.dir}" destdir="${doc.dir}" author="true" version="true" use="true" windowtitle="GWT Chismes">
			<classpath refid="gwt.classpath" />
			<packageset dir="${src.dir}" defaultexcludes="yes" />
		</javadoc>
	</target>

	<target name="clean">
		<delete dir="${tmp.dir}" />
		<delete dir="${tmp.dir}" />
		<delete dir="${doc.dir}" />
		<delete dir="${project}-${version}" />
	</target>

	<target name="all" depends="clean, jar, javadoc" />

	<target name="sample">
		<echo message="Compiling sample from java to javascript" />
		<java classname="com.google.gwt.dev.GWTCompiler" fork="yes" failonerror="true">
			<classpath>
				<pathelement location="${src.dir}" />
				<pathelement location="${gwt.user.jar}" />
				<pathelement location="${gwt.servlet.jar}" />
				<pathelement location="${gwt.dev.jar}" />
			</classpath>
			<arg value="-style" />
			<arg value="OBFUSCATED" />
			<arg value="-out" />
			<arg file="www" />
			<arg value="${sample.module}" />
		</java>
	</target>

	<target name="zip" depends=" jar, javadoc, sample">
		<delete dir="${project}-${version}" />
		<delete file="${project}-${version}.zip" />
		<mkdir dir="${project}-${version}" />
		<echo message="aaa" />
		<copy todir="${project}-${version}/${src.dir}">
			<fileset dir="${src.dir}" />
		</copy>
		<copy todir="${project}-${version}/${doc.dir}">
			<fileset dir="${doc.dir}" />
		</copy>
		<copy todir="${project}-${version}/www">
			<fileset dir="www" />
		</copy>
		<copy todir="${project}-${version}/" file="LICENSE" />
		<copy todir="${project}-${version}/" file="build.xml" />
		<copy todir="${project}-${version}/" file=".classpath" />
		<copy todir="${project}-${version}/" file=".project" />
		<exec dir="." executable="zip">
			<arg line="-r ${project}-${version}.zip ${project}-${version}" />
		</exec>
		<delete dir="${project}-${version}" />
	</target>
	
	<target name="distribution" depends="clean, zip, clean"/>
</project>
